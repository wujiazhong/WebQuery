<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
	<body>
		 <div class="col-md-offset-1 col-md-10 container" id="update_today_data">
		 	<br><br>
			<button class="btn btn-default col-md-offset-5 col-md-2 col-lg-2">手动更新数据表</button><br><br>
		 	<div class="panel panel-default">
			   <div class="panel-body">
			      	没有数据更新的信息！
			   </div>
			   <div class="panel-footer">共有 0 个表的数据被手动更新</div>
			</div>
		 </div>
		 <div class="col-md-offset-1 col-md-10 container" id="update_oper_time">
		 	<br><br>
		 	<div class="col-md-6">
		 		<h4>结腊日期更新表</h4>
			  	<label>选择井号： </label>
				<select class="selectpicker" id="jl_jh_combobox" class="jh_combobox"></select>
			</div>
			<div class="col-md-6">
				<h4>洗井日期更新表</h4>
			  	<label>选择井号： </label>
				<select class="selectpicker" id="xj_jh_combobox" class="jh_combobox"></select>
			</div>
			<div class="col-md-12 container">
				<div class="container col-md-6 col-lg-6" id="jl_date">
					<div class="container col-md-12 table_div">
						<table id="jl_date_table" class="display" cellspacing="0" width="100%">
							<thead>
								<tr>
									<th>井号</th>
									<th>结蜡日期</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<br>
						<div class="table_btn_group">
							<button id="jl_add_btn" class="btn btn-default" data-toggle="modal" data-target="#add_row">增加</button>
			                <button id="jl_edit_btn" class="btn btn-default" data-toggle="modal" data-target="#edit_row">
			                	编辑
			                </button>
			                <button id="jl_del_btn" class="btn btn-default" data-toggle="modal" data-target="#del_row">删除</button>
			                <button id="jl_submit_btn" class="btn btn-default" data-toggle="modal" data-target="#submit_row">确定</button>
						</div>
					</div>
				</div>
					
				<div class="container col-md-6 col-lg-6" id="xj_date">
					<div class="container col-md-12 table_div">
						<table id="xj_date_table" class="display" cellspacing="0" width="100%">
							<thead>
								<tr>
									<th>井号</th>
									<th>洗井日期</th>
								</tr>
							</thead>
							<tbody>
							</tbody>
						</table>
						<br>
						<div class="table_btn_group">
							<button id="xj_add_btn" class="btn btn-default" data-toggle="modal" data-target="#add_row">增加</button>
			                <button id="xj_edit_btn" class="btn btn-default" data-toggle="modal" data-target="#edit_row">
			                	编辑
			                </button>
			                <button id="xj_del_btn" class="btn btn-default" data-toggle="modal" data-target="#del_row">删除</button>
			                <button id="xj_submit_btn" class="btn btn-default" data-toggle="modal" data-target="#submit_row">确定</button>
		        		</div>
		        	</div>
				</div>
				
				<!-- 模态框（Modal） -->
				<div class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
				   <div class="modal-dialog">
				      <div class="modal-content">
				         <div class="modal-header">
				            <button type="button" class="close" data-dismiss="modal"aria-hidden="true" style="color:#F2F2F2">×</button>
				            <h4 class="modal-title" id="myModalLabel"></h4>
				         </div>
				         <div class="modal-body"></div>
				         <div class="modal-footer">
				            <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
				            <button type="button" class="btn btn-primary modal_submit_btn">提交</button>
				         </div>
				      </div><!-- /.modal-content -->
				   </div><!-- /.modal-dialog -->
				</div><!-- /.modal -->
		 	</div>
		 </div>

		<script type="text/javascript" src="./js/jquery.js"></script>
		<script type="text/javascript" src="./datatable/js/jquery.dataTables.js"></script>
		<script type="text/javascript" src="js/bootstrap.min.js"></script>
  		<script type="text/javascript" src="./js/jquery.cookie.js"></script>
  		<script type="text/javascript" src="js/method.js"></script>
  		<script type="text/javascript" src="js/json2.js"></script>
  		<script type="text/javascript">
  			$(document).ready(function(){  
  				/*
  				 *This class used to stands for date data recorded in two tables
  				 *@ version
  				 *@ author
  				 */				  				
  				function jhOperDateObj(oper,well_name){
  					this.oper = oper; 
  					this.jh = well_name;
  					this.date_list = new Array();
  					this.date_origin_list = new Array();
  				}
  				//0: no modification, -1: delete from db, 1: modified
  				jhOperDateObj.prototype = {
  					addItem: function(oper_type, content, flag){
  						if(oper_type != this.oper)
  							return false;  	
  						var isOldData = false;
  						$.each(this.date_list, function(key,val){
							if(val.date == content){
								if(val.status == "del"){
									val.status = "origin";
								}else if(val.status == "none"){
									val.status = "new";
								}
								isOldData = true;
								return false;
							}
						});
  						if(isOldData)
  							return false;
  						
						this.date_list.push({date:content,status:flag});
						if(flag == "origin"){
							this.date_origin_list.push({date:content,status:flag});
						}else{
							this.date_origin_list.push({date:"none",status:"none"});
						}
  					},
  					
  					editDate: function(oper_type,src_date, des_date){
  						if(oper_type != this.oper)
  							return false;
						$.each(this.date_list, function(key,val){
							if(val.date == src_date){
								val.date = des_date;
								if(val.status == "origin")
									val.status = "edit";
								return false;
							}
						});
  					},
  					
  					delItem: function(oper_type,src_date){
  						if(oper_type != this.oper)
  							return false;
						$.each(this.date_list, function(key,val){
							if(val.date == src_date){
								if(val.status == "origin" || val.status == "edit"){
									val.status = "del";
								}else if(val.status = "new"){
									val.status="none";
								}
							}
						});
  					}
  				}//jhOperDateObj end
  				
/*   				$.fn.createTableHead = function(){
					var $jh_th = $("<th>").text("井号");
					var $jl_date_th = $("<th>").text("结蜡日期");
					var $isNew_th = $("<th>").text("isNewData");
					var $new_tr = $("<tr>").append($jh_th).append($jl_date_th).append($isNew_th);
					var $new_thead = $("<thead>").append($new_tr);
					$(this).append($new_thead);
  				} */
  				
  				$.fn.updateTable = function(info, table_name){		
  					var table_id = $(this).attr("id");
  					$("#"+table_id+" tbody").empty(); 
  					var list = info.date_list;
   					var cur_jh = info.jh;
   					
  					$.each(list, function(index, val){
  						if(val.status=="del" || val.status=="none")
  							return true;
       					var $new_jh_td = $("<td>").text(cur_jh);
       					var $new_jl_td = $("<td>").text($.trim(val.date));
       					//var $new_status_td = $("<td>").text(val.status)
       					$("<tr>").append($new_jh_td).append($new_jl_td).appendTo($("#"+table_id+" tbody"));
  					}); 
  					
		  			$("#"+table_id).dataTable({
		  				"searching": false,
		  				"bInfo":false,
		  				"bPaginate": false,
		  				"bRetrieve": true,
		  				"bSort": false
		  			}); 				
  				}
  				
				$.fn.selectSingleRow = function(){
  					var table_id = $(this).attr("id");
	  				$("#"+table_id+" tbody").on("click", "tr",function (){
				        if ($(this).hasClass("selected")) {
				            $(this).removeClass("selected");
				        }else {
				            $("#"+table_id+" tbody tr.selected").removeClass("selected");
				            $(this).addClass("selected");
				        }	  	
				    });			
	  			}
		  				
  				$.fn.editTableRowClick = function(action_abbr,action_name, table_id, input_id,table_info_list,combobox_name){
  					$(this).on("click", function(){ 
	  					var $selected_row =  $("#"+table_id+" tbody tr.selected");
	  					var cur_jh = $("#"+combobox_name).find("option:selected").text();

				    	if(!$selected_row.length){
				    		alert("请在表格中选择要编辑的行！");
				    		return false;
				    	}
				    	
	  					$(".modal-body").empty();
	  					$("#myModalLabel").text("修正"+action_name+"日期");
	  					
	  					var $jh_label = $("<label>").text("原"+$("#"+table_id+" th").eq(0).text()).css("margin-right","10px").css("width","100px");
	  					//var $jh_input = $("<input>").val($selected_row.children("td").eq(0).text()).attr("disabled","true");
	  					var $jh_input = $("<input>").val(cur_jh).attr("disabled","true");
	  					var $jh_div = $("<div>").append($jh_label).append($jh_input);
	  					
	  					var $date_label = $("<label>").text($("#"+table_id+" th").eq(1).text()).css("margin-right","10px").css("width","100px");
				    	var $date_input = $("<input>").val($selected_row.children("td").eq(1).text()).attr("disabled","true");
				    	var $date_div = $("<div>").append($date_label).append($date_input);
				    	
				    	var $fix_date_label = $("<label>").text("修正"+action_name+"日期").css("margin-right","10px").css("width","100px");
				    	var $fix_date_input = $("<input placeholder='填写新的日期'>").attr("id",input_id.fix_date);
				    	var $fix_date_div = $("<div>").append($fix_date_label).append($fix_date_input);
				    	
				    	var $tip = $("<div>").text("*注意：修正日期的格式必须是yyyy-mm-dd，例如2015-03-02");
				    	
				    	$(".modal-body").append($jh_div).append($date_div).append($fix_date_div).append($tip);
				    	$(".modal-footer button[class*='modal_submit_btn']").remove();
				    	$("<button type='button' class='btn btn-primary modal_submit_btn' id='edit'>").text("提交").appendTo($(".modal-footer"));

				    	$(".modal").modal("show");
				    	$("#edit").on("click",function(){
				    		var input_text = $(".modal-body input[id='"+input_id.fix_date+"']").val();
					    	if(!checkDate(input_text)){
					    		alert("所填写的日期格式不正确或不存在，请检查！");
					    		return false;
					    	}
				    		
					    	if(isDateDuplicate(input_text,cur_jh,action_abbr,table_info_list)){
					    		alert("所填写的日期已经存在，请检查！");
					    		return false;
					    	}
					    	
					    	var src_date = $selected_row.children("td").eq(1).text();
					    								    	
					    	$.each(table_info_list, function(index,val){
					    		if(val.jh == cur_jh){
					    			val.editDate(action_abbr,src_date,input_text);
					    			return false;
					    		}
					    	});
					    	
					    	$selected_row.children("td").eq(1).text(input_text);
					    	$(".modal").modal("hide");	
					    	$(".modal-body").empty();
				    	});
				    });
  				}
		  				
  				$.fn.addTableRowClick = function(action_abbr, action_name, table_id, input_id,table_info_list,combobox_name){
  					$(this).on("click", function(){ 
	  					$(".modal-body").empty();
	  					$("#myModalLabel").text("修正"+action_name+"日期");
	  					var cur_jh = $("#"+combobox_name).find("option:selected").text();
	  					
	  					var $jh_label = $("<label>").text($("#"+table_id+" th").eq(0).text()).css("margin-right","10px").css("width","100px");
		  				//var $jh_input = $("<input>").attr("id", input_id.jh).attr("disabled","true");
		  				var $jh_input = $("<input>").val(cur_jh).attr("id", input_id.jh).attr("disabled","true");
		  				var $jh_div = $("<div>").append($jh_label).append($jh_input);
		  				
		  				var $date_label = $("<label>").text($("#"+table_id+" th").eq(1).text()).css("margin-right","10px").css("width","100px");
				    	var $date_input = $("<input>").attr("id", input_id.date);
				    	var $date_div = $("<div>").append($date_label).append($date_input);
				    	
				    	var $tip = $("<div>").text("*注意：1.请确保所填井队正确； 2.修正日期的格式必须是yyyy-mm-dd，例如2015-03-02");
				    	$(".modal-body").append($jh_div).append($jh_div).append($date_div).append($tip);
				    	$(".modal-footer button[class*='modal_submit_btn']").remove();
				    	$("<button type='button' class='btn btn-primary modal_submit_btn' id='add'>").text("提交").appendTo($(".modal-footer"));
					   	$(".modal").modal("show");
					   	$("#add").on("click",function(){
					   		var input_text = $(".modal-body input[id='"+input_id.date+"']").val();
					    	if(!checkDate(input_text)){
					    		alert("所填写的日期格式不正确或不存在，请检查！");
					    		return false;
					    	}
					    	if(isDateDuplicate(input_text,cur_jh,action_abbr,table_info_list)){
					    		alert("所填写的日期已经存在，请检查！");
					    		return false;
					    	}
					    	
					    	var index = parseInt($("#"+table_id+" tbody tr").length) - 1;
					    	var $new_tr = $("<tr>")
					    							 
					    	$.each($(".modal-body").find("input"), function(key, val){
					    		var input_text = $(this).val();
					    		var $new_td = $("<td>").text(input_text).appendTo($new_tr);
					    	});
					    	
					    	$new_tr.insertAfter($("#"+table_id+" tbody").find("tr").eq(index));							    	
					    	$.each(table_info_list, function(index,val){
					    		if(val.jh == cur_jh){
					    			val.addItem(action_abbr,input_text,"new");
					    			return false;
					    		}
					    	});
					    	
				  			$("#"+table_id).dataTable({
				  				"searching": false,
				  				"bInfo":false,
				  				"bPaginate": false,
				  				"bRetrieve": true,
				  				"bSort": false
				  			});

					    	$(".modal").modal("hide");	
					    	$(".modal-body").empty();
					   	});
					});
  				}
		  		
  				$.fn.delTableRowClick = function(action_abbr,table_id, table_info_list,combobox_name){
  					$(this).on("click", function(){
  						var $selected_row =  $("#"+table_id+" tbody tr.selected");
	  					var cur_jh = $("#"+combobox_name).find("option:selected").text();

				    	if(!$selected_row.length){
				    		alert("请在表格中选择要删除的行！");
				    		return false;
				    	}
				    	$(".modal-body").empty();
				    	$("#myModalLabel").text("");
				    	var $tip_msg_div = $("<div>").text("确定删除该行数据？");
				    	$(".modal-footer button[class*='modal_submit_btn']").remove();
				    	$(".modal-body").append($tip_msg_div);
				    	$("<button type='button' class='btn btn-primary modal_submit_btn' id='del'>").text("确定").appendTo($(".modal-footer"));
				    	$(".modal").modal("show");
				    	
				    	$("#del").on("click",function(){
				    		var src_date = $selected_row.children("td").eq(1).text();
					    	$.each(table_info_list, function(index,val){
					    		if(val.jh == cur_jh){
					    			val.delItem(action_abbr,src_date);
					    			return false;
					    		}
					    	});
					    	
					    	
					    	$("#"+table_id).dataTable({
				  				"searching": false,
				  				"bInfo":false,
				  				"bPaginate": false,
				  				"bRetrieve": true,
				  				"bSort": false
				  			});
					    	
					    	$("#"+table_id+" tbody tr.selected").remove();
					    	$(".modal").modal("hide");	
					    	$(".modal-body").empty();
				    	});
  					});
  				}
  				
		  		function getOperDateByWellName(well_name){
           			var oper_date = [];
           			$.each(well_info, function(index,val){
         				if(well_name == val.well_name){
         					oper_date = val;
         					return false;
         				}
         			});
           		}
  				
		  		function isDateDuplicate(date,cur_jh,abbr_oper,table_info_list){
		  			var isDuplicate = false;
		  			var isBreak = false;
		  			$.each(table_info_list,function(key,val){
		  				if(cur_jh == val.jh && abbr_oper == val.oper){
			  				$.each(val.date_list,function(index,item){
			  					/* console.log("item_date:"+item.date+"  date:"+date+ "item_status:"+item.status) */
			  					if(item.date == date && item.status != "del" && item.status != "none"){
			  						isDuplicate = true;
			  						isBreak = true;
			  						return false
			  					}
			  				});
		  				}
		  				if(isBreak)
		  					return false;
		  			});
  					return isDuplicate;
		  		}
		  		
  				function checkDate(date){
  					//check if chars only has num
  					var isRightDate = true;
  					var reg = /^\d{4}(-\d{2}){2}$/;
  					isRightDate = reg.test(date);
 					if(!isRightDate){
 						return isRightDate;
 					}
 						
 					//check if it is a right date
				    var ds=date.match(/\d+/g),ts=["getFullYear","getMonth","getDate"];
				    var d=new Date(date.replace(/-/g,'/')),i=3;
				    ds[1]--; //Date class, month index form 0, eg. Jan==0, Oct==9
				    while(i--){
				    	if( ds[i]*1!=d[ts[i]]()){
				    		isRightDate = false;
				    		return isRightDate;
				    	}
				    }
				    if(ds[0]<1900){
				    	isRightDate = false;
				    	return isRightDate;
				    }
				    
				    var now = new Date();
					var year = now.getFullYear();  						
			        var month = now.getMonth() + 1;     
					if(month < 10)
			            month = "0"+month;
			        var day = now.getDate(); 
			        if(day < 10)
			        	day = "0"+day;

					var d_str = year.toString()+month.toString()+day.toString();
					var input_date = date.replace(/-/g,'');

					if(parseInt(d_str)-parseInt(input_date)<0){
						isRightDate = false;
						return isRightDate;
					}

				    return isRightDate;
			    }
  				function removeItem(list,index){
  					var list_len = parsInt(list.length);
  					if(index == list_len){
  						return (list.slice(0,list_len-1))
  					} else {
  						return (list.slice(0, index).concat(index+1));
  					}
  				}
  				function refreshTableInfoList(table_info_list){
  					$.each(table_info_list,function(index, val){
  						var del_index_list = []
  						$.each(val.date_list, function(date_index, date_item){
  							if(date_item.status == "new" || date_item.status == "edit"){
  								date_item.status = "origin";
  								val.date_origin_list[date_index].date = date_item.date;
  								val.date_origin_list[date_index].status = "origin";
  							}else if(date_item.status == "del"){
  								date_item.status = "none";
  								val.date_origin_list[date_index].date = date_item.date;
  								val.date_origin_list[date_index].status = "none";
  								del_index_list.push(date_index);
  							}
  						});
  						for(var i=0;i<del_index_list.length;i++){
  							val.date_list = removeItem(val.date_list,i);
  							val.date_origin_list = removeItem(val.date_origin_list,i);
  						}
  					});
  				}
  				function parseJSONStr(oper,table_info_list){
  					var combobox = '';
  					if(oper == "xj"){
  						combobox = "xj_jh_combobox";
  					}else{
  						combobox = "jl_jh_combobox";
  					}
  					var cur_jh = $("#"+combobox).find("option:selected").text();

	  				var data_list = {};
	  				data_list = new Array();
	  				
	  				var new_content_list={};
	  				new_content_list.type = "new";
	  				new_content_list.content = new Array();
	  				
	  				var edit_content_list = {};
	  				edit_content_list.type = "edit";
	  				edit_content_list.content = new Array(); 
	  				
	  				var del_content_list={};
	  				del_content_list.type = "del";
	  				del_content_list.content = new Array();
	  				
	  				$.each(table_info_list,function(key,val){
	  					var del_list = [];
	  					var del_origin_date_list = [];
		  				var new_list = [];
		  				var new_origin_date_list = [];
		  				var edit_list = [];
		  				var edit_origin_date_list = [];
	  					if(val.oper == oper && val.jh==cur_jh){
	  						$.each(val.date_list,function(index,datetime){
	  							if(datetime.status=="new"){
	  								new_list.push(datetime.date);
	  								new_origin_date_list.push(val.date_origin_list[index].date);
	  							}
								if(datetime.status=="del"){
	  								del_list.push(datetime.date);
	  								del_origin_date_list.push(val.date_origin_list[index].date);
	  							}
								if(datetime.status=="edit"){
	  								edit_list.push(datetime.date);
	  								edit_origin_date_list.push(val.date_origin_list[index].date);
	  							}
	  						});

	  						if(new_list.length>0){
	  							var new_jsonObj = {};
	  							new_jsonObj.well_name = cur_jh;
  								new_jsonObj.date = new_list;
  								new_jsonObj.origin_date = new_origin_date_list;
  								new_content_list.content.push(new_jsonObj);
	  						}
	  						if(edit_list.length>0){
	  							var edit_jsonObj = {};
  								edit_jsonObj.well_name = cur_jh;
  								edit_jsonObj.date = edit_list;
  								edit_jsonObj.origin_date = edit_origin_date_list;
  								edit_content_list.content.push(edit_jsonObj);		  								
	  						}
	  						if(del_list.length>0){
	  							var del_jsonObj = {};
  								del_jsonObj.well_name = cur_jh;
  								del_jsonObj.date = del_list;
  								del_jsonObj.origin_date = del_origin_date_list;
  								del_content_list.content.push(del_jsonObj);
	  						}
	  					}
	  				});
	  				
	  				if(new_content_list.content.length>0){
	  					data_list.push(new_content_list);
					}
					if(edit_content_list.content.length>0){
						data_list.push(edit_content_list);
					}
					if(del_content_list.content.length>0){
						data_list.push(del_content_list);
					}
					var jsonstr = JSON.stringify(data_list);
	  				return jsonstr;
  				}
  				
  				$.ajax({
    			  type: "post",
                  url:  "GetWellOperDate_do",
                  data: {"userteam": $.cookie("userteam")},
                  dataType: "json",
                  success: function(data){
                        if(data.length == 0){
                        	alert("数据库中没有该井队的结蜡或洗井数据！");
                        	return false;
                        }	  	

                  		var well_info = data;
                  		var xj_jh_list = [];
                  		var jl_jh_list = [];
                  		var jl_table_info_list = new Array();
                  		var xj_table_info_list = new Array();
               			$.each(well_info, function(index,val){
               				var table_item = new jhOperDateObj(val.oepration,val.well_name);
               				
               				$.each(val.date, function(index,item){
                  				table_item.addItem(val.oepration,item,"origin");
                  			});
               				
               				if(val.oepration == "xj"){
               					xj_jh_list.push(val.well_name);
               					xj_table_info_list.push(table_item);
               				}else if(val.oepration == "jl"){
               					jl_jh_list.push(val.well_name);
               					jl_table_info_list.push(table_item);
               				}
               			});
                  		initSelectMenu(xj_jh_list, "xj_jh_combobox");    
                  		initSelectMenu(jl_jh_list, "jl_jh_combobox"); 
                  		
                  		$("#xj_jh_combobox").change(function(event){
                  			var cur_jh = $("#xj_jh_combobox").find("option:selected").text();
                  			
                  			$.each(xj_table_info_list, function(index,val){
                  				if(val.jh == cur_jh){
                  					$("#xj_date_table").updateTable(val,"xj"); 
                  					return false;
                  				}	
                  			});
                  		});
                  		$("#jl_jh_combobox").change(function(event){
                  			var cur_jh = $("#jl_jh_combobox").find("option:selected").text();
                  			
                  			$.each(jl_table_info_list, function(index,val){
                  				if(val.jh == cur_jh){
                  					$("#jl_date_table").updateTable(val,"jl"); 
                  					return false;
                  				}	
                  			});
                  		});
/*                   		$("#jh_combobox").change(function(event){
                  			var cur_jh = $("#jh_combobox").find("option:selected").text();
                  			
                  			$.each(table_info_list, function(index,val){
                  				if(val.jh == cur_jh){
                  					$("#jl_date_table").updateTable(val,"jl");
                  					$("#xj_date_table").updateTable(val,"xj"); 
                  					return false;
                  				}	
                  			});
                  		}); */
                  		
                  		$("#jl_jh_combobox").trigger("change"); 
                  		$("#xj_jh_combobox").trigger("change"); 
		  					  				
			  			//set jl_date_table single select
			  			function input(jh,date,fix_date){
			  				this.jh = jh;
			  				this.date = date;
			  				this.fix_date = fix_date;
			  			}
			  			var jl_input_id = new input("jh","jl_date","jl_fix_date");
			  			$("#jl_date_table").selectSingleRow();
			  			$("#jl_date button[id='jl_edit_btn']").editTableRowClick("jl","结蜡","jl_date_table", jl_input_id,jl_table_info_list,"jl_jh_combobox");
			  			$("#jl_date button[id='jl_add_btn']").addTableRowClick("jl","结蜡","jl_date_table",jl_input_id,jl_table_info_list,"jl_jh_combobox");	
			  			$("#jl_date button[id='jl_del_btn']").delTableRowClick("jl","jl_date_table",jl_table_info_list,"jl_jh_combobox");
						
						var xj_input_id = new input("jh","xj_date","xj_fix_date");
			  			$("#xj_date_table").selectSingleRow();
			  			$("#xj_date button[id='xj_edit_btn']").editTableRowClick("xj","洗井","xj_date_table", xj_input_id,xj_table_info_list,"xj_jh_combobox");
			  			$("#xj_date button[id='xj_add_btn']").addTableRowClick("xj","洗井","xj_date_table",xj_input_id,xj_table_info_list,"xj_jh_combobox");
			  			$("#xj_date button[id='xj_del_btn']").delTableRowClick("xj","xj_date_table",xj_table_info_list,"xj_jh_combobox");
			  			
			  			$("#xj_submit_btn").on("click",function(){		
			  				var xj_json = parseJSONStr("xj",xj_table_info_list);
			  				if(xj_json == "[]"){
			  					alert("没有数据需要更新！");	
			  					return false;
			  				}

				  			$.ajax({
				  				type: "post",
				                url:  "UpdateWellOperDate_do",
				                data: {"json_str":xj_json,"userteam":$.cookie("userteam"),"unioncode": $.cookie("unioncode"),
				                	   "oper":"xj"},
				                dataType: "json",
				                success: function(flag){
				                	if(flag){
				                		alert("洗井日期更新成功！");
				                		refreshTableInfoList(xj_table_info_list);
				                	}else{
				                		alert("洗井日期更新失败！");
				                	}
				                },
				                error: function(){
				                	alert("更新数据库失败！");
				                }
				  			});
			  			});
			  			
			  			$("#jl_submit_btn").on("click",function(){		
			  				var jl_json = parseJSONStr("jl",jl_table_info_list);

			  				if(jl_json == "[]"){
			  					alert("没有数据需要更新！");	
			  					return false;
			  				}
			  				
				  			$.ajax({
				  				type: "post",
				                url:  "UpdateWellOperDate_do",
				                data: {"json_str":jl_json,"userteam":$.cookie("userteam"),"unioncode": $.cookie("unioncode"),
				                	   "oper":"jl"},
				                dataType: "json",
				                success: function(flag){
				                	if(flag){
				                		alert("结蜡日期更新成功！");
				                		refreshTableInfoList(jl_table_info_list);
				                	}else{
				                		alert("结蜡日期更新失败！");
				                	}
				                },
				                error: function(){
				                	alert("更新数据库失败！");
				                }
				  			});
			  			});
                  	
                    },
			  		error: function(){
			  			alert("向数据库请求数据失败！");
                  	}
            	});		
			});
  			
  			
  		</script>
	</body>
</html>